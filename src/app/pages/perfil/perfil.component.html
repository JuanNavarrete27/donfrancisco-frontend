<div class="perfil-background" [class.locked]="showFeedback">
  <div class="perfil-sparks"></div>

  <div class="perfil-container">
    <!-- ================= HEADER ================= -->
    <div class="perfil-header">
      <h1 class="perfil-title">
        {{ isRegisterMode ? 'Crear cuenta' : 'Iniciar sesión' }}
      </h1>

      <div class="mode-switch">
        <button
          type="button"
          [class.active]="!isRegisterMode"
          (click)="toggleMode(false)"
        >
          Ingresar
        </button>

        <button
          type="button"
          [class.active]="isRegisterMode"
          (click)="toggleMode(true)"
        >
          Registrarme
        </button>
      </div>
    </div>

    <!-- ================= FORM ================= -->
    <form class="login-form" (ngSubmit)="onSubmit()" autocomplete="on">

      <!-- REGISTRO: NOMBRE / APELLIDO -->
      <div class="dual-row" *ngIf="isRegisterMode">
        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="nombre"
            required
          />
        </div>

        <div class="form-group">
          <label for="apellido">Apellido</label>
          <input
            type="text"
            id="apellido"
            name="apellido"
            [(ngModel)]="apellido"
            required
          />
        </div>
      </div>

      <!-- ================= TELÉFONO ================= -->
      <div class="form-group phone-group" *ngIf="isRegisterMode">
        <label for="telefono">Teléfono</label>

        <div class="phone-input-wrapper">

          <!-- PAÍS SELECCIONADO -->
          <button
            type="button"
            class="country-select"
            (click)="toggleCountryMenu()"
          >
            <span class="flag">{{ selectedCountry.flag }}</span>
            <span class="dial-code">{{ selectedCountry.dial }}</span>
          </button>

          <!-- DROPDOWN PAÍSES -->
          <div class="country-dropdown" *ngIf="countryMenuOpen">
            <button
              type="button"
              class="country-option"
              *ngFor="let c of countries"
              (click)="selectCountry(c)"
            >
              <span class="flag">{{ c.flag }}</span>
              <span class="name">
                {{ c.code === 'UY' ? 'Uruguay'
                  : c.code === 'AR' ? 'Argentina'
                  : c.code === 'BR' ? 'Brasil'
                  : 'Chile' }}
              </span>
              <span class="dial">{{ c.dial }}</span>
            </button>
          </div>

          <!-- INPUT TELÉFONO -->
          <input
            type="tel"
            id="telefono"
            name="telefono"
            [(ngModel)]="telefono"
            [placeholder]="selectedCountry.placeholder"
            required
          />
        </div>
      </div>

      <!-- EMAIL -->
      <div class="form-group">
        <label for="email">Correo electrónico</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="email"
          autocomplete="email"
          required
        />
      </div>

      <!-- PASSWORD -->
      <div class="dual-row">
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input
            type="password"
            id="password"
            name="password"
            [(ngModel)]="password"
            [autocomplete]="isRegisterMode ? 'new-password' : 'current-password'"
            required
          />
        </div>

        <div class="form-group" *ngIf="isRegisterMode">
          <label for="confirmPassword">Repetir contraseña</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            autocomplete="new-password"
            required
          />
        </div>
      </div>

      <!-- FEEDBACK SIMPLE -->
      <div class="feedback" *ngIf="errorMessage">
        <p class="error">{{ errorMessage }}</p>
      </div>

      <!-- BOTÓN -->
      <button
        type="submit"
        class="login-button"
        [disabled]="loading"
      >
        {{ loading
          ? 'Procesando...'
          : (isRegisterMode ? 'Crear cuenta' : 'Iniciar sesión')
        }}
      </button>
    </form>
  </div>

  <!-- ================= FEEDBACK PREMIUM ================= -->
  <div class="premium-feedback" *ngIf="showFeedback">
    <div
      class="feedback-card"
      [class.success]="feedbackType === 'success'"
      [class.error]="feedbackType === 'error'"
    >
      <div class="icon">
        <span *ngIf="feedbackType === 'success'">✔</span>
        <span *ngIf="feedbackType === 'error'">✕</span>
      </div>

      <p class="message">
        {{ feedbackMessage }}
      </p>
    </div>
  </div>
</div>
