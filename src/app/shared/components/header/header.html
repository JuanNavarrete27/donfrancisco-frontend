<header class="header" [class.scrolled]="isScrolled">
  <div class="container">
    <div class="header__content">

      <!-- LOGO -->
      <a routerLink="/inicio" class="header__logo" #logoElement>
        <img
          [src]="logoPath"
          alt="Don Francisco"
          (error)="handleImageError($event)"
        />
      </a>

      <!-- NAV DESKTOP -->
      <nav class="nav">
        <ul class="nav__list" #navLinks>
          <li
            *ngFor="let item of navItems"
            [class.has-dd]="item.label === 'Locales'"
            (mouseenter)="item.label === 'Locales' ? openLocalesDesktop() : null"
            (mouseleave)="item.label === 'Locales' ? closeLocalesDesktop() : null"
          >

            <!-- ITEM NORMAL -->
            <ng-container *ngIf="item.label !== 'Locales'; else localesDropdown">
              <a
                [routerLink]="item.path"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: true }"
              >
                {{ item.label }}
              </a>
            </ng-container>

            <!-- LOCALES + FLECHA + DROPDOWN -->
            <ng-template #localesDropdown>
              <a
                [routerLink]="item.path"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: true }"
              >
                {{ item.label }}
              </a>

              <button
                class="nav__dd-arrow"
                type="button"
                aria-label="Abrir menú de Locales"
                aria-haspopup="menu"
                [attr.aria-expanded]="isLocalesOpenDesktop"
                (click)="toggleLocalesDesktop($event)"
              >
                <svg
                  class="chev"
                  [class.open]="isLocalesOpenDesktop"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M6 9l6 6 6-6"></path>
                </svg>
              </button>

              <div class="nav__dd" [class.open]="isLocalesOpenDesktop" role="menu">
                <a
                  *ngFor="let opt of localesItems"
                  [routerLink]="opt.path"
                  role="menuitem"
                  (click)="onLocalesNavigate()"
                >
                  {{ opt.label }}
                </a>
              </div>
            </ng-template>
          </li>
        </ul>

        <!-- ====== DESKTOP: BOTONES LOGIN / PERFIL ====== -->

        <!-- SI NO ESTÁ LOGUEADO -->
        <a
          *ngIf="!isLogged"
          routerLink="/perfil"
          class="btn-square"
          (click)="closeMenu()"
        >
          Iniciar Sesión
        </a>

        <!-- SI ESTÁ LOGUEADO: PERFIL -->
        <a
          *ngIf="isLogged"
          routerLink="/perfil/me"
          class="btn-square profile-btn"
          (click)="closeMenu()"
        >
          <!-- Ícono SVG de usuario -->
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="10" cy="6" r="4"></circle>
            <path d="M2 18c2-4 6-6 8-6s6 2 8 6"></path>
          </svg>
          Perfil
        </a>

        <!-- SI ESTÁ LOGUEADO: CERRAR SESIÓN -->
        <button
          *ngIf="isLogged"
          class="btn-square logout-btn"
          (click)="cerrarSesion()"
        >
          <!-- Ícono logout -->
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 3H5a2 2 0 0 0-2 2v10a2
             2 0 0 0 2 2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Salir
        </button>
      </nav>

      <!-- HAMBURGER BUTTON -->
      <button
        #navToggle
        class="hamburger"
        [class.active]="isMenuOpen"
        (click)="toggleMenu($event)"
        aria-label="Menú"
      >
        <span></span><span></span><span></span>
      </button>

    </div>
  </div>

  <!-- MOBILE MENU -->
  <div class="mobile-menu" [class.active]="isMenuOpen">

    <!-- BOTÓN CERRAR -->
    <button class="close-btn" (click)="closeMenu()" aria-label="Cerrar menú">
      ✕
    </button>

    <ul class="mobile-menu__list">
      <li *ngFor="let item of navItems" [class.mobile-has-dd]="item.label === 'Locales'">

        <!-- ITEM NORMAL -->
        <ng-container *ngIf="item.label !== 'Locales'; else mobileLocalesDropdown">
          <a
            [routerLink]="item.path"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            (click)="closeMenu()"
          >
            {{ item.label }}
          </a>
        </ng-container>

        <!-- LOCALES (MOBILE) + FLECHA + PANEL -->
        <ng-template #mobileLocalesDropdown>
          <div class="mobile-dd-row">
            <a
              [routerLink]="item.path"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeMenu()"
            >
              {{ item.label }}
            </a>

            <button
              class="mobile-dd-arrow"
              type="button"
              aria-label="Abrir submenú de Locales"
              aria-haspopup="menu"
              [attr.aria-expanded]="isLocalesOpenMobile"
              (click)="toggleLocalesMobile($event)"
            >
              <svg
                class="chev"
                [class.open]="isLocalesOpenMobile"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M6 9l6 6 6-6"></path>
              </svg>
            </button>
          </div>

          <div class="mobile-dd-panel" [class.open]="isLocalesOpenMobile" role="menu">
            <a
              *ngFor="let opt of localesItems"
              [routerLink]="opt.path"
              role="menuitem"
              (click)="onLocalesNavigate()"
            >
              {{ opt.label }}
            </a>
          </div>
        </ng-template>

      </li>
    </ul>

    <!-- ====== MOBILE: LOGIN / PERFIL / LOGOUT ====== -->

    <!-- SI NO ESTÁ LOGUEADO -->
    <a
      *ngIf="!isLogged"
      routerLink="/perfil"
      class="btn-square mobile"
      (click)="closeMenu()"
    >
      Iniciar Sesión
    </a>

    <!-- MOBILE PERFIL -->
    <a
      *ngIf="isLogged"
      routerLink="/perfil/me"
      class="btn-square mobile"
      (click)="closeMenu()"
    >
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="10" cy="6" r="4"></circle>
        <path d="M2 18c2-4 6-6 8-6s6 2 8 6"></path>
      </svg>
      Perfil
    </a>

    <!-- MOBILE LOGOUT -->
    <button
      *ngIf="isLogged"
      class="btn-square mobile logout-btn"
      (click)="cerrarSesion()"
    >
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 3H5a2 2 0 0 0-2 2v10a2
         2 0 0 0 2 2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      Salir
    </button>
  </div>

  <!-- OVERLAY -->
  <div class="overlay" *ngIf="isMenuOpen" (click)="closeMenu()"></div>
</header>
